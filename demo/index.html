<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>TNA.js Interactive Demo</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: #f0f2f5;
      color: #333;
      min-height: 100vh;
    }

    header {
      background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
      color: #fff;
      padding: 20px 32px;
      display: flex;
      align-items: baseline;
      gap: 16px;
    }

    header h1 {
      font-size: 22px;
      font-weight: 700;
      letter-spacing: -0.5px;
    }

    header p {
      font-size: 13px;
      color: #8899aa;
    }

    main {
      max-width: 1280px;
      margin: 20px auto;
      padding: 0 20px;
      display: grid;
      grid-template-columns: 260px 1fr;
      grid-template-rows: auto auto;
      gap: 16px;
    }

    .panel {
      background: #fff;
      border-radius: 10px;
      box-shadow: 0 1px 4px rgba(0,0,0,0.08);
      padding: 20px;
    }

    .panel-title {
      font-size: 13px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      color: #888;
      margin-bottom: 14px;
    }

    /* ─── Controls Sidebar ─── */
    .controls {
      grid-row: 1 / 3;
    }

    .control-group {
      margin-bottom: 18px;
    }

    .control-group label {
      display: block;
      font-size: 12px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      color: #666;
      margin-bottom: 6px;
    }

    .control-group select {
      width: 100%;
      padding: 7px 10px;
      border: 1px solid #ddd;
      border-radius: 6px;
      font-size: 13px;
      background: #fff;
      cursor: pointer;
    }

    .control-group select:focus {
      outline: none;
      border-color: #4e79a7;
    }

    .control-group select:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .slider-row {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .slider-row input[type="range"] {
      flex: 1;
      accent-color: #4e79a7;
      height: 6px;
    }

    .slider-value {
      font-size: 13px;
      font-weight: 600;
      color: #4e79a7;
      min-width: 32px;
      text-align: right;
    }

    .checkbox-row {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .checkbox-row input[type="checkbox"] {
      accent-color: #4e79a7;
      width: 16px;
      height: 16px;
    }

    .checkbox-row span {
      font-size: 13px;
      font-weight: 500;
    }

    .summary {
      margin-top: 20px;
      padding-top: 16px;
      border-top: 1px solid #eee;
    }

    .summary .panel-title {
      margin-bottom: 10px;
    }

    #model-summary div {
      font-size: 13px;
      padding: 3px 0;
      display: flex;
      justify-content: space-between;
    }

    #model-summary strong {
      color: #666;
      font-weight: 500;
    }

    #model-summary span {
      font-weight: 600;
      color: #333;
    }

    /* ─── Network Graph ─── */
    .network-panel {
      min-height: 440px;
      display: flex;
      flex-direction: column;
    }

    .network-panel svg {
      flex: 1;
    }

    #network-graph {
      width: 100%;
      flex: 1;
    }

    /* ─── Charts Row ─── */
    .charts-row {
      grid-column: 1 / -1;
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 16px;
    }

    .centrality-panel {
      min-height: 340px;
      display: flex;
      flex-direction: column;
    }

    .centrality-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 12px;
    }

    .centrality-header select {
      padding: 5px 10px;
      border: 1px solid #ddd;
      border-radius: 6px;
      font-size: 12px;
      background: #fff;
    }

    .chart-container {
      flex: 1;
    }

    .freq-mosaic-row {
      grid-column: 1 / -1;
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 16px;
    }

    /* ─── SVG Styles ─── */
    .node-label {
      font-size: 9px;
      font-weight: 600;
      fill: #fff;
      pointer-events: none;
      text-anchor: middle;
    }

    .link {
      fill: none;
      stroke-opacity: 0.5;
    }

    .sequence-panel {
      grid-column: 1 / -1;
    }

    .axis text {
      font-size: 11px;
    }

    .axis .domain {
      display: none;
    }

    /* ─── Intro Section ─── */
    .intro {
      max-width: 1280px;
      margin: 0 auto;
      padding: 16px 20px 0;
    }

    .intro-inner {
      background: #fff;
      border-radius: 10px;
      box-shadow: 0 1px 4px rgba(0,0,0,0.08);
      padding: 20px 28px;
    }

    .intro p {
      font-size: 14px;
      line-height: 1.65;
      color: #444;
      margin-bottom: 10px;
    }

    .intro p:last-child {
      margin-bottom: 0;
    }

    .intro a {
      color: #4e79a7;
      text-decoration: none;
    }

    .intro a:hover {
      text-decoration: underline;
    }

    /* ─── Footer ─── */
    footer {
      background: #1a1a2e;
      color: #ccc;
      margin-top: 32px;
      padding: 32px 20px 28px;
    }

    .footer-inner {
      max-width: 1280px;
      margin: 0 auto;
      display: grid;
      grid-template-columns: 1fr 1fr 2fr;
      gap: 32px;
    }

    .footer-section h3 {
      font-size: 13px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      color: #8899aa;
      margin-bottom: 10px;
    }

    .footer-section p {
      font-size: 13px;
      line-height: 1.6;
    }

    .footer-section ul,
    .footer-section ol {
      font-size: 13px;
      line-height: 1.7;
      padding-left: 18px;
    }

    .footer-section a {
      color: #7aaddb;
      text-decoration: none;
    }

    .footer-section a:hover {
      text-decoration: underline;
      color: #a0cbef;
    }

    .footer-section ol li {
      margin-bottom: 8px;
    }

    .footer-section em {
      font-style: italic;
      color: #aaa;
    }

    /* ─── Tooltip ─── */
    .tooltip {
      position: fixed;
      pointer-events: none;
      background: rgba(0,0,0,0.8);
      color: #fff;
      padding: 6px 10px;
      border-radius: 5px;
      font-size: 12px;
      white-space: nowrap;
      opacity: 0;
      transition: opacity 0.15s;
      z-index: 100;
    }
  </style>
</head>
<body>
  <header>
    <h1>TNA.js Interactive Demo</h1>
    <p>Transition Network Analysis in the browser</p>
  </header>

  <section class="intro">
    <div class="intro-inner">
      <p>
        This is an interactive demo of <a href="https://github.com/mohsaqr/tna-js" target="_blank"><strong>tnaj</strong></a>,
        a pure TypeScript/JavaScript implementation of <strong>Transition Network Analysis (TNA)</strong>.
        TNA is a novel framework for modeling, visualizing, and identifying temporal patterns in sequential data.
        It represents sequences as weighted directed networks where nodes are states and edges are transitions,
        enabling the application of network science methods (centralities, community detection, pruning) to
        understand the structure and dynamics of sequential processes.
      </p>
      <p>
        The package runs entirely in the browser with zero server-side dependencies.
        It is a port of the
        <a href="https://cran.r-project.org/package=TNA" target="_blank">R TNA package</a> and the
        <a href="https://github.com/mohsaqr/tnapy" target="_blank">Python tna package</a>,
        validated for numerical equivalence with R to machine epsilon (~10<sup>-15</sup>).
        Use the controls below to explore different model types, pruning thresholds, and community detection methods.
      </p>
    </div>
  </section>

  <main>
    <!-- Controls Sidebar -->
    <div class="controls panel">
      <div class="panel-title">Controls</div>

      <div class="control-group">
        <label>Model Type</label>
        <select id="model-type">
          <option value="tna" selected>TNA (Relative)</option>
          <option value="ftna">FTNA (Frequency)</option>
          <option value="ctna">CTNA (Co-occurrence)</option>
          <option value="atna">ATNA (Attention)</option>
        </select>
      </div>

      <div class="control-group">
        <label>Prune Threshold</label>
        <div class="slider-row">
          <input type="range" id="prune-threshold" min="0" max="0.30" step="0.01" value="0">
          <span class="slider-value" id="prune-value">0.00</span>
        </div>
      </div>

      <div class="control-group">
        <div class="checkbox-row">
          <input type="checkbox" id="community-toggle">
          <span>Community Detection</span>
        </div>
      </div>

      <div class="control-group">
        <label>Community Method</label>
        <select id="community-method" disabled></select>
      </div>

      <div class="summary">
        <div class="panel-title">Model Summary</div>
        <div id="model-summary"></div>
      </div>
    </div>

    <!-- Network Graph -->
    <div class="network-panel panel">
      <div class="panel-title">Network Graph</div>
      <div id="network-graph"></div>
    </div>

    <!-- Charts Row: Two centrality charts side by side -->
    <div class="charts-row">
      <div class="centrality-panel panel">
        <div class="centrality-header">
          <div class="panel-title" style="margin-bottom:0">Centralities</div>
          <select id="centrality-measure-1"></select>
        </div>
        <div class="chart-container" id="centrality-chart-1"></div>
      </div>
      <div class="centrality-panel panel">
        <div class="centrality-header">
          <div class="panel-title" style="margin-bottom:0">Centralities</div>
          <select id="centrality-measure-2"></select>
        </div>
        <div class="chart-container" id="centrality-chart-2"></div>
      </div>
    </div>

    <!-- Frequency + Mosaic Row -->
    <div class="freq-mosaic-row">
      <div class="panel">
        <div class="panel-title">State Frequencies</div>
        <div id="frequency-chart"></div>
      </div>
      <div class="panel">
        <div class="panel-title">State Associations (Mosaic)</div>
        <div id="mosaic-plot"></div>
      </div>
    </div>

    <!-- Sequence Plot -->
    <div class="sequence-panel panel">
      <div class="panel-title">Sequence Index Plot</div>
      <div id="sequence-plot"></div>
    </div>

    <!-- Distribution Plot -->
    <div class="sequence-panel panel">
      <div class="panel-title">State Distribution Over Time</div>
      <div id="distribution-plot"></div>
    </div>
  </main>

  <footer>
    <div class="footer-inner">
      <div class="footer-section">
        <h3>Authors</h3>
        <p>Mohammed Saqr, Sonsoles L&oacute;pez-Pernas, Santtu Tikka</p>
      </div>
      <div class="footer-section">
        <h3>Packages</h3>
        <ul>
          <li><a href="https://github.com/mohsaqr/tna-js" target="_blank">tnaj</a> &mdash; TypeScript/JavaScript (this demo)</li>
          <li><a href="https://cran.r-project.org/package=tna" target="_blank">tna</a> &mdash; R (CRAN)</li>
          <li><a href="https://github.com/mohsaqr/tnapy" target="_blank">tna</a> &mdash; Python (PyPI)</li>
        </ul>
      </div>
      <div class="footer-section">
        <h3>References</h3>
        <ol>
          <li>Saqr, M., L&oacute;pez-Pernas, S., T&ouml;rm&auml;nen, T., Kaliisa, R., Misiejuk, K., &amp; Tikka, S. (2025). Transition Network Analysis: A Novel Framework for Modeling, Visualizing, and Identifying the Temporal Patterns of Learners and Learning Processes. In <em>Proceedings of the 15th International Learning Analytics and Knowledge Conference (LAK '25)</em>, 351&ndash;361. <a href="https://doi.org/10.1145/3706468.3706513" target="_blank">doi:10.1145/3706468.3706513</a></li>
          <li>Tikka, S., L&oacute;pez-Pernas, S., &amp; Saqr, M. (2025). tna: An R Package for Transition Network Analysis. <em>Applied Psychological Measurement</em>. <a href="https://doi.org/10.1177/01466216251348840" target="_blank">doi:10.1177/01466216251348840</a></li>
          <li>Saqr, M., L&oacute;pez-Pernas, S., &amp; Tikka, S. (2025). Mapping relational dynamics with transition network analysis: A primer and tutorial. In <em>Advanced Learning Analytics Methods: AI, Precision and Complexity</em>. Springer.</li>
          <li>Saqr, M., L&oacute;pez-Pernas, S., &amp; Tikka, S. (2025). Capturing the breadth and dynamics of the temporal process with frequency transition network analysis. In <em>Advanced Learning Analytics Methods: AI, Precision and Complexity</em>. Springer.</li>
          <li>L&oacute;pez-Pernas, S., Tikka, S., &amp; Saqr, M. (2025). Mining patterns and clusters with transition network analysis: A heterogeneity approach. In <em>Advanced Learning Analytics Methods: AI, Precision and Complexity</em>. Springer.</li>
        </ol>
      </div>
    </div>
  </footer>

  <div class="tooltip" id="tooltip"></div>

  <script type="module" src="./main.ts"></script>
</body>
</html>
